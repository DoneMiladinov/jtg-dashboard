<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campaign Insights - JT Global</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{font-family:'Open Sans',-apple-system,BlinkMacSystemFont,sans-serif;background:linear-gradient(145deg,#13002d 0%,#1a0442 50%,#0f0025 100%);min-height:100vh;padding:80px 30px 50px;color:#fff;position:relative}
    body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background:radial-gradient(ellipse at 20% 20%,rgba(139,92,246,.08) 0%,transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(167,139,250,.06) 0%,transparent 50%);pointer-events:none;z-index:0}

    /* Loading State */
    .loading{display:flex;align-items:center;justify-content:center;min-height:60vh;flex-direction:column;gap:16px}
    .loading-spinner{width:40px;height:40px;border:3px solid rgba(167,139,250,.2);border-top-color:#a78bfa;border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading-text{font-size:14px;color:rgba(255,255,255,.5);letter-spacing:.5px}
    .error-state{text-align:center;padding:60px 20px}
    .error-state h2{color:rgba(255,255,255,.7);font-size:18px;margin-bottom:8px}
    .error-state p{color:rgba(255,255,255,.4);font-size:14px}

    /* Nav */
    .nav-bar{position:fixed;top:0;left:0;right:0;background:rgba(19,0,45,.95);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.08);z-index:1000;padding:0 30px}
    .nav-container{max-width:980px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:60px}
    .nav-logo{height:22px;opacity:.9}
    .nav-links{display:flex;gap:8px}
    .nav-link{color:rgba(255,255,255,.6);text-decoration:none;font-size:11px;font-weight:500;padding:8px 12px;border-radius:8px;transition:all .3s;text-transform:uppercase;letter-spacing:.6px}
    .nav-link:hover{color:rgba(255,255,255,.95);background:rgba(139,92,246,.2)}
    .nav-link.active{color:#a78bfa;background:rgba(139,92,246,.15)}

    /* Container */
    .container{max-width:980px;margin:0 auto;position:relative;z-index:1}

    /* Header */
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-top:20px}
    .header-left{display:flex;align-items:center;gap:16px}
    .logo-stack{height:28px}
    .header-divider{width:1px;height:20px;background:rgba(255,255,255,.15)}
    .client-name{font-size:18px;font-weight:600;color:rgba(255,255,255,.85);letter-spacing:-.01em}
    .header-right{text-align:right}
    .report-label{font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:rgba(255,255,255,.4);margin-bottom:4px;font-weight:600}
    .date-range{font-size:14px;color:rgba(255,255,255,.65);font-weight:400}

    /* Month Selector */
    .month-selector{display:flex;gap:8px;margin-bottom:40px;flex-wrap:wrap}
    .month-pill{padding:8px 18px;border-radius:24px;font-size:12px;font-weight:600;letter-spacing:.3px;cursor:pointer;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:rgba(255,255,255,.6);transition:all .3s;user-select:none}
    .month-pill:hover{background:rgba(139,92,246,.15);border-color:rgba(167,139,250,.3);color:rgba(255,255,255,.85)}
    .month-pill.active{background:linear-gradient(135deg,rgba(139,92,246,.3),rgba(167,139,250,.15));border-color:rgba(167,139,250,.4);color:#fff;box-shadow:0 2px 12px rgba(139,92,246,.2)}

    /* Sections */
    .section{padding-top:30px;margin-bottom:60px;scroll-margin-top:80px}
    .section-title{margin:0 0 24px;font-size:14px;text-transform:uppercase;letter-spacing:1.5px;color:rgba(255,255,255,.5);font-weight:600;display:flex;align-items:center;gap:12px}
    .section-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(255,255,255,.1),transparent)}

    /* Metric Cards */
    .metrics-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:20px}
    .metric-card{background:linear-gradient(165deg,rgba(255,255,255,.06) 0%,rgba(255,255,255,.02) 100%);border:1px solid rgba(255,255,255,.08);border-radius:24px;padding:28px 22px;text-align:center;position:relative;overflow:hidden;display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:140px;transition:transform .2s,box-shadow .2s}
    .metric-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.2)}
    .metric-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent)}
    .metric-card.highlight{background:linear-gradient(165deg,rgba(139,92,246,.16) 0%,rgba(167,139,250,.06) 100%);border-color:rgba(167,139,250,.2)}
    .metric-value{font-size:36px;font-weight:700;color:#fff;margin-bottom:8px;line-height:1;letter-spacing:-.02em}
    .metric-label{font-size:11px;color:rgba(255,255,255,.5);font-weight:600;text-transform:uppercase;letter-spacing:1.2px;margin-bottom:6px}
    .metric-subtext{font-size:13px;color:rgba(167,139,250,.7);font-weight:400}
    .metric-subtext.good{color:#4ade80}

    /* Today Card Special */
    .today-detail{font-size:13px;color:rgba(255,255,255,.7);line-height:1.8}
    .today-detail span{color:#a78bfa;font-weight:600}

    /* Charts */
    .charts-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
    .chart-container{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:24px}
    .chart-title{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.4);margin-bottom:20px;font-weight:600}
    .bar-chart{display:flex;flex-direction:column;gap:12px}
    .bar-row{display:grid;grid-template-columns:120px 1fr 50px;align-items:center;gap:12px}
    .bar-label{font-size:12px;color:rgba(255,255,255,.8);font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .bar-track{height:20px;background:rgba(255,255,255,.05);border-radius:5px;overflow:hidden}
    .bar-fill{height:100%;border-radius:5px;transition:width .6s ease-out;min-width:2px}
    .bar-fill.positive{background:linear-gradient(90deg,#22c55e,#4ade80)}
    .bar-fill.reply{background:linear-gradient(90deg,#8b5cf6,#a78bfa)}
    .bar-value{font-size:12px;color:rgba(255,255,255,.7);text-align:right;font-weight:600}

    /* Table */
    .table-wrap{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:16px;overflow:hidden}
    .table-scroll{overflow-x:auto}
    table{width:100%;border-collapse:collapse;font-size:13px;min-width:800px}
    thead tr{background:rgba(255,255,255,.02);border-bottom:1px solid rgba(255,255,255,.06)}
    th,td{text-align:left;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06)}
    th{color:rgba(255,255,255,.4);font-weight:500;text-transform:uppercase;letter-spacing:.8px;font-size:10px;cursor:pointer;user-select:none;transition:color .2s;white-space:nowrap}
    th:hover{color:rgba(255,255,255,.7)}
    th .sort-icon{display:inline-block;margin-left:4px;opacity:.4;font-size:8px}
    th.sort-asc .sort-icon{opacity:1}
    th.sort-desc .sort-icon{opacity:1}
    td{color:rgba(255,255,255,.8)}
    tbody tr:last-child td{border-bottom:none}
    tbody tr:hover{background:rgba(255,255,255,.02)}
    tfoot tr{background:rgba(255,255,255,.04)}
    tfoot td{font-weight:600;color:rgba(255,255,255,.9);border-bottom:none}
    .numeric{text-align:right}

    /* Badges */
    .badge{padding:4px 10px;border-radius:6px;font-size:12px;font-weight:500;display:inline-block}
    .badge-strong{background:rgba(34,197,94,.2);color:#4ade80}
    .badge-average{background:rgba(59,130,246,.2);color:#60a5fa}
    .badge-weak{background:rgba(234,179,8,.2);color:#facc15}

    /* Footer */
    .footer{margin-top:50px;padding-top:24px;border-top:1px solid rgba(255,255,255,.06);display:flex;justify-content:space-between;align-items:center}
    .footer-left{display:flex;flex-direction:column;gap:4px}
    .footer-text{font-size:11px;color:rgba(255,255,255,.3);letter-spacing:.5px;font-weight:400}
    .footer-date{font-size:10px;color:rgba(255,255,255,.2);letter-spacing:.3px}
    .footer-logo{height:20px;opacity:.3}

    /* Responsive */
    @media(max-width:800px){
      body{padding:80px 16px 30px}
      .metrics-grid{grid-template-columns:1fr}
      .charts-row{grid-template-columns:1fr}
      .metric-value{font-size:32px}
      .header{flex-direction:column;gap:20px}
      .header-right{text-align:center}
      .nav-links{display:none}
      .month-selector{justify-content:center}
      .bar-row{grid-template-columns:80px 1fr 45px}
    }

    /* Fade-in animation */
    @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeUp .4s ease-out both}
    .fade-in:nth-child(1){animation-delay:.05s}
    .fade-in:nth-child(2){animation-delay:.1s}
    .fade-in:nth-child(3){animation-delay:.15s}
  </style>
</head>
<body>
  <nav class="nav-bar">
    <div class="nav-container">
      <img src="https://cdn.prod.website-files.com/67a3b299626c1a7afb14beb6/67a4b0de8c572bff612d91d1_stack-optimize-logo.avif" alt="StackOptimise" class="nav-logo">
      <div class="nav-links">
        <a href="#overview" class="nav-link active">Overview</a>
        <a href="#strategy" class="nav-link">Strategy</a>
      </div>
    </div>
  </nav>

  <div class="container" id="app">
    <div class="loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading campaign data...</div>
    </div>
  </div>

  <script>
    (async function() {
      const app = document.getElementById('app');

      /* ── Fetch Data ── */
      let DATA;
      try {
        const res = await fetch('data.json');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        DATA = await res.json();
      } catch (e) {
        app.innerHTML = '<div class="error-state"><h2>Unable to load data</h2><p>Could not fetch data.json &mdash; ' + e.message + '</p></div>';
        return;
      }

      const LOGO = 'https://cdn.prod.website-files.com/67a3b299626c1a7afb14beb6/67a4b0de8c572bff612d91d1_stack-optimize-logo.avif';
      const monthKeys = Object.keys(DATA.months).sort();
      let currentMonth = monthKeys[monthKeys.length - 1]; // default to latest

      /* ── Helpers ── */
      function fmt(n) { return Number(n).toLocaleString(); }
      function pct(num, den) { return den > 0 ? ((num / den) * 100).toFixed(2) + '%' : '0.00%'; }
      function pctNum(num, den) { return den > 0 ? (num / den) * 100 : 0; }
      function parseDate(iso) {
        const d = new Date(iso);
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
      }

      /* ── Aggregate across all months (Lifetime) ── */
      function getLifetimeData() {
        let leads = 0, replies = 0, positives = 0, leadsToday = 0, repliesToday = 0, positivesToday = 0;
        const stratMap = {};
        const allDateRanges = [];
        for (const key of monthKeys) {
          const m = DATA.months[key];
          leads += m.overview.leads;
          replies += m.overview.replies;
          positives += m.overview.positives;
          leadsToday += m.overview.leadsToday;
          repliesToday += m.overview.repliesToday;
          positivesToday += m.overview.positivesToday;
          if (m.dateRange) allDateRanges.push(m.dateRange);
          for (const s of m.strategy) {
            if (!stratMap[s.name]) {
              stratMap[s.name] = { name: s.name, leads: 0, replies: 0, positives: 0, leadsToday: 0, repliesToday: 0, positivesToday: 0 };
            }
            stratMap[s.name].leads += s.leads;
            stratMap[s.name].replies += s.replies;
            stratMap[s.name].positives += s.positives;
            stratMap[s.name].leadsToday += s.leadsToday;
            stratMap[s.name].repliesToday += s.repliesToday;
            stratMap[s.name].positivesToday += s.positivesToday;
          }
        }
        // Build lifetime date range from first start to last end
        let dateRange = '';
        if (allDateRanges.length === 1) {
          dateRange = allDateRanges[0];
        } else if (allDateRanges.length > 1) {
          const first = allDateRanges[0].split(' - ')[0];
          const last = allDateRanges[allDateRanges.length - 1].split(' - ')[1];
          dateRange = first + ' - ' + last;
        }
        return {
          label: 'Lifetime',
          dateRange: dateRange,
          overview: { leads, replies, positives, leadsToday, repliesToday, positivesToday },
          strategy: Object.values(stratMap)
        };
      }

      function getMonthData(key) {
        if (key === 'lifetime') return getLifetimeData();
        return DATA.months[key];
      }

      /* ── Badge class by rank within a sorted array ── */
      function badgeClass(value, sortedValues) {
        if (sortedValues.length <= 1) return 'badge-strong';
        const rank = sortedValues.indexOf(value);
        const third = sortedValues.length / 3;
        if (rank < third) return 'badge-strong';
        if (rank < third * 2) return 'badge-average';
        return 'badge-weak';
      }

      /* ── Render Dashboard ── */
      function render(monthKey) {
        currentMonth = monthKey;
        const d = getMonthData(monthKey);
        const ov = d.overview;
        const strats = d.strategy;

        const replyRate = pctNum(ov.replies, ov.leads);
        const positiveRate = pctNum(ov.positives, ov.replies);
        const leadsPerPositive = ov.positives > 0 ? Math.round(ov.leads / ov.positives) : '—';

        // Sort strategies by positive rate for charts
        const stratsByPosRate = [...strats].sort((a, b) => pctNum(b.positives, b.replies) - pctNum(a.positives, a.replies));
        const stratsByReplyRate = [...strats].sort((a, b) => pctNum(b.replies, b.leads) - pctNum(a.replies, a.leads));
        const maxPosRate = stratsByPosRate.length ? pctNum(stratsByPosRate[0].positives, stratsByPosRate[0].replies) : 1;
        const maxReplyRate = stratsByReplyRate.length ? pctNum(stratsByReplyRate[0].replies, stratsByReplyRate[0].leads) : 1;

        // Sorted values for badge assignment
        const replyPcts = strats.map(s => pctNum(s.replies, s.leads)).sort((a, b) => b - a);
        const posPcts = strats.map(s => pctNum(s.positives, s.replies)).sort((a, b) => b - a);

        // Table rows (default sort by leads desc)
        const tableStrats = [...strats].sort((a, b) => b.leads - a.leads);

        // Month pills
        let pills = '<div class="month-pill' + (monthKey === 'lifetime' ? ' active' : '') + '" data-month="lifetime">Lifetime</div>';
        for (const k of monthKeys) {
          const mLabel = DATA.months[k].label + (DATA.months[k].dateRange ? ' (' + DATA.months[k].dateRange + ')' : '');
          pills += '<div class="month-pill' + (monthKey === k ? ' active' : '') + '" data-month="' + k + '">' + mLabel + '</div>';
        }

        // Totals for table footer
        const totLeads = strats.reduce((s, r) => s + r.leads, 0);
        const totReplies = strats.reduce((s, r) => s + r.replies, 0);
        const totPositives = strats.reduce((s, r) => s + r.positives, 0);
        const totLeadsToday = strats.reduce((s, r) => s + r.leadsToday, 0);
        const totRepliesToday = strats.reduce((s, r) => s + r.repliesToday, 0);

        // Positive rate chart bars
        let posChartBars = '';
        for (const s of stratsByPosRate) {
          const rate = pctNum(s.positives, s.replies);
          const width = maxPosRate > 0 ? Math.max((rate / maxPosRate) * 100, 2) : 2;
          posChartBars += '<div class="bar-row"><div class="bar-label" title="' + s.name + '">' + s.name + '</div><div class="bar-track"><div class="bar-fill positive" style="width:' + width + '%"></div></div><div class="bar-value">' + pct(s.positives, s.replies) + '</div></div>';
        }

        // Reply rate chart bars
        let replyChartBars = '';
        for (const s of stratsByReplyRate) {
          const rate = pctNum(s.replies, s.leads);
          const width = maxReplyRate > 0 ? Math.max((rate / maxReplyRate) * 100, 2) : 2;
          replyChartBars += '<div class="bar-row"><div class="bar-label" title="' + s.name + '">' + s.name + '</div><div class="bar-track"><div class="bar-fill reply" style="width:' + width + '%"></div></div><div class="bar-value">' + pct(s.replies, s.leads) + '</div></div>';
        }

        // Table rows
        let tableRows = '';
        for (const s of tableStrats) {
          const rp = pctNum(s.replies, s.leads);
          const pp = pctNum(s.positives, s.replies);
          const rpBadge = badgeClass(rp, replyPcts);
          const ppBadge = badgeClass(pp, posPcts);
          tableRows += '<tr>' +
            '<td>' + s.name + '</td>' +
            '<td class="numeric">' + fmt(s.leads) + '</td>' +
            '<td class="numeric">' + fmt(s.replies) + '</td>' +
            '<td class="numeric"><span class="badge ' + rpBadge + '">' + pct(s.replies, s.leads) + '</span></td>' +
            '<td class="numeric">' + fmt(s.positives) + '</td>' +
            '<td class="numeric"><span class="badge ' + ppBadge + '">' + pct(s.positives, s.replies) + '</span></td>' +
            '<td class="numeric">' + fmt(s.leadsToday) + '</td>' +
            '<td class="numeric">' + fmt(s.repliesToday) + '</td>' +
            '</tr>';
        }

        app.innerHTML = `
          <header class="header fade-in">
            <div class="header-left">
              <img src="${LOGO}" alt="StackOptimise" class="logo-stack">
              <div class="header-divider"></div>
              <span class="client-name">${DATA.client}</span>
            </div>
            <div class="header-right">
              <div class="report-label">${d.label} Campaign Insights</div>
              <div class="date-range">${d.dateRange || parseDate(DATA.lastUpdated)}</div>
            </div>
          </header>

          <div class="month-selector fade-in">
            ${pills}
          </div>

          <!-- Overview -->
          <section id="overview" class="section fade-in">
            <h2 class="section-title">Overview &mdash; Top Metrics</h2>
            <div class="metrics-grid">
              <div class="metric-card">
                <div class="metric-value">${fmt(ov.leads)}</div>
                <div class="metric-label">Leads Contacted</div>
                <div class="metric-subtext good">total volume</div>
              </div>
              <div class="metric-card">
                <div class="metric-value">${fmt(ov.replies)}</div>
                <div class="metric-label">Replies</div>
                <div class="metric-subtext good">${pct(ov.replies, ov.leads)} reply rate</div>
              </div>
              <div class="metric-card">
                <div class="metric-value">${fmt(ov.positives)}</div>
                <div class="metric-label">Positive Replies</div>
                <div class="metric-subtext good">${pct(ov.positives, ov.replies)} of replies</div>
              </div>
            </div>
            <div class="metrics-grid">
              <div class="metric-card">
                <div class="metric-value">${leadsPerPositive}</div>
                <div class="metric-label">Leads / Positive</div>
                <div class="metric-subtext good">efficiency ratio</div>
              </div>
              <div class="metric-card highlight">
                <div class="metric-value">${pct(ov.replies, ov.leads)}</div>
                <div class="metric-label">Overall Reply Rate</div>
                <div class="metric-subtext good">replies / leads</div>
              </div>
              <div class="metric-card">
                <div class="metric-value">Today</div>
                <div class="metric-label">Today's Activity</div>
                <div class="today-detail">
                  <span>+${fmt(ov.leadsToday)}</span> leads &nbsp;&bull;&nbsp;
                  <span>+${fmt(ov.repliesToday)}</span> replies
                </div>
              </div>
            </div>
          </section>

          <!-- Strategy -->
          <section id="strategy" class="section fade-in">
            <h2 class="section-title">Strategy Segmentation</h2>
            <div class="charts-row">
              <div class="chart-container">
                <div class="chart-title">Positive Rate by Strategy</div>
                <div class="bar-chart">${posChartBars}</div>
              </div>
              <div class="chart-container">
                <div class="chart-title">Reply Rate by Strategy</div>
                <div class="bar-chart">${replyChartBars}</div>
              </div>
            </div>
            <div class="table-wrap"><div class="table-scroll">
              <table class="sortable" id="strategyTable">
                <thead><tr>
                  <th data-sort="string" data-col="0">Strategy <span class="sort-icon">&#9660;</span></th>
                  <th class="numeric" data-sort="number" data-col="1">Leads <span class="sort-icon">&#9660;</span></th>
                  <th class="numeric" data-sort="number" data-col="2">Replies <span class="sort-icon">&#9660;</span></th>
                  <th class="numeric" data-sort="percent" data-col="3">Reply % <span class="sort-icon">&#9660;</span></th>
                  <th class="numeric" data-sort="number" data-col="4">Positives <span class="sort-icon">&#9660;</span></th>
                  <th class="numeric" data-sort="percent" data-col="5">Pos % <span class="sort-icon">&#9660;</span></th>
                  <th class="numeric" data-sort="number" data-col="6">Today +Leads <span class="sort-icon">&#9660;</span></th>
                  <th class="numeric" data-sort="number" data-col="7">Today +Replies <span class="sort-icon">&#9660;</span></th>
                </tr></thead>
                <tbody>${tableRows}</tbody>
                <tfoot><tr>
                  <td>Total</td>
                  <td class="numeric">${fmt(totLeads)}</td>
                  <td class="numeric">${fmt(totReplies)}</td>
                  <td class="numeric">${pct(totReplies, totLeads)}</td>
                  <td class="numeric">${fmt(totPositives)}</td>
                  <td class="numeric">${pct(totPositives, totReplies)}</td>
                  <td class="numeric">${fmt(totLeadsToday)}</td>
                  <td class="numeric">${fmt(totRepliesToday)}</td>
                </tr></tfoot>
              </table>
            </div></div>
          </section>

          <footer class="footer fade-in">
            <div class="footer-left">
              <span class="footer-text">Generated by StackOptimise</span>
              <span class="footer-date">Last updated: ${parseDate(DATA.lastUpdated)}</span>
            </div>
            <img src="${LOGO}" alt="StackOptimise" class="footer-logo">
          </footer>
        `;

        bindEvents();
      }

      /* ── Event Bindings ── */
      function bindEvents() {
        // Month pills
        document.querySelectorAll('.month-pill').forEach(pill => {
          pill.addEventListener('click', () => {
            render(pill.dataset.month);
          });
        });

        // Sortable table
        document.querySelectorAll('#strategyTable thead th').forEach(th => {
          th.addEventListener('click', () => {
            const table = document.getElementById('strategyTable');
            const tbody = table.querySelector('tbody');
            const ths = table.querySelectorAll('th');
            const col = parseInt(th.dataset.col);
            const type = th.dataset.sort;
            if (!type) return;

            const asc = th.classList.contains('sort-asc');
            ths.forEach(h => {
              h.classList.remove('sort-asc', 'sort-desc');
              h.querySelector('.sort-icon').innerHTML = '&#9660;';
            });
            th.classList.add(asc ? 'sort-desc' : 'sort-asc');
            th.querySelector('.sort-icon').innerHTML = asc ? '&#9660;' : '&#9650;';

            const rows = Array.from(tbody.querySelectorAll('tr'));
            rows.sort((a, b) => {
              let av = a.cells[col].textContent.trim();
              let bv = b.cells[col].textContent.trim();
              if (type === 'number') {
                av = parseFloat(av.replace(/,/g, '')) || 0;
                bv = parseFloat(bv.replace(/,/g, '')) || 0;
              } else if (type === 'percent') {
                av = parseFloat(av.replace('%', '')) || 0;
                bv = parseFloat(bv.replace('%', '')) || 0;
              }
              if (av < bv) return asc ? 1 : -1;
              if (av > bv) return asc ? -1 : 1;
              return 0;
            });
            rows.forEach(r => tbody.appendChild(r));
          });
        });

        // Active nav on scroll
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.nav-link');
        function updateNav() {
          const sp = window.scrollY + 100;
          sections.forEach(s => {
            if (sp >= s.offsetTop && sp < s.offsetTop + s.offsetHeight) {
              navLinks.forEach(l => {
                l.classList.toggle('active', l.getAttribute('href') === '#' + s.id);
              });
            }
          });
        }
        window.addEventListener('scroll', updateNav);
        updateNav();
      }

      /* ── Initial Render ── */
      render(currentMonth);
    })();
  </script>
</body>
</html>
