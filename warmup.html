<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warmup Score Timeline - JT Global</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e4e4e4;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2rem;
            color: #fff;
            margin-bottom: 8px;
        }

        .header .subtitle {
            color: #8892b0;
            font-size: 0.95rem;
        }

        .header .updated {
            color: #64ffda;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .dashboard {
            max-width: 1100px;
            margin: 0 auto;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-container h2 {
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 20px;
        }

        .chart-wrapper {
            position: relative;
            height: 450px;
        }

        .legend-custom {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #e4e4e4;
        }

        .legend-item .line {
            width: 24px;
            height: 3px;
            border-radius: 2px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            color: #64ffda;
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        th:first-child, td:first-child {
            text-align: left;
        }

        td {
            color: #e4e4e4;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        tr:first-child td {
            background: rgba(100, 255, 218, 0.05);
            font-weight: 600;
        }

        .table-scroll {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.5rem; }
            .chart-wrapper { height: 350px; }
            table { font-size: 0.75rem; }
            th, td { padding: 8px 6px; white-space: nowrap; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>Warmup Score Timeline</h1>
            <div class="subtitle">JT Global</div>
            <div class="updated">Auto-updated daily via GitHub Actions</div>
        </div>

        <!-- Line Chart -->
        <div class="chart-container">
            <h2>Email Count by Score Range Over Time</h2>
            <div class="chart-wrapper">
                <canvas id="lineChart"></canvas>
            </div>
            <div class="legend-custom">
                <div class="legend-item"><div class="line" style="background: #00d2d3;"></div> 100%</div>
                <div class="legend-item"><div class="line" style="background: #2ed573;"></div> 90-99%</div>
                <div class="legend-item"><div class="line" style="background: #7bed9f;"></div> 85-89%</div>
                <div class="legend-item"><div class="line" style="background: #ffcd38;"></div> 80-84%</div>
                <div class="legend-item"><div class="line" style="background: #ffa502;"></div> 70-79%</div>
                <div class="legend-item"><div class="line" style="background: #ff4757;"></div> &lt;70%</div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="chart-container">
            <h2>Daily Breakdown (Most Recent First)</h2>
            <div class="table-scroll">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Total</th>
                        <th style="color: #00d2d3">100%</th>
                        <th style="color: #2ed573">90-99%</th>
                        <th style="color: #7bed9f">85-89%</th>
                        <th style="color: #ffcd38">80-84%</th>
                        <th style="color: #ffa502">70-79%</th>
                        <th style="color: #ff4757">&lt;70%</th>
                    </tr>
                </thead>
                <tbody id="dataTable">
                </tbody>
            </table>
            </div>
        </div>
    </div>

    <script>
        // DATA_PLACEHOLDER - This gets replaced by daily_sync.py
        const data = {"Feb 10": {"<70%": 0, "70-79%": 0, "80-84%": 0, "85-89%": 5, "90-99%": 32, "100%": 76}, "Feb 11": {"<70%": 0, "70-79%": 0, "80-84%": 0, "85-89%": 7, "90-99%": 37, "100%": 69}, "Feb 12": {"<70%": 0, "70-79%": 0, "80-84%": 0, "85-89%": 7, "90-99%": 40, "100%": 66}, "Feb 13": {"<70%": 0, "70-79%": 0, "80-84%": 0, "85-89%": 9, "90-99%": 40, "100%": 64}};

        const dates = Object.keys(data);
        const datesReversed = [...dates].reverse();
        const buckets = ['100%', '90-99%', '85-89%', '80-84%', '70-79%', '<70%'];
        const bucketColors = {
            '100%': '#00d2d3',
            '90-99%': '#2ed573',
            '85-89%': '#7bed9f',
            '80-84%': '#ffcd38',
            '70-79%': '#ffa502',
            '<70%': '#ff4757'
        };

        // Chart defaults
        Chart.defaults.color = '#8892b0';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

        // Line Chart (chronological order for chart)
        new Chart(document.getElementById('lineChart'), {
            type: 'line',
            data: {
                labels: dates,
                datasets: buckets.map(bucket => ({
                    label: bucket,
                    data: dates.map(d => data[d][bucket]),
                    borderColor: bucketColors[bucket],
                    backgroundColor: bucketColors[bucket] + '20',
                    borderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    tension: 0.3,
                    fill: false
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(26, 26, 46, 0.95)',
                        titleColor: '#fff',
                        bodyColor: '#e4e4e4',
                        padding: 12,
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.raw.toLocaleString()} emails`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255, 255, 255, 0.05)' },
                        ticks: { callback: v => v.toLocaleString() },
                        title: {
                            display: true,
                            text: 'Number of Emails',
                            color: '#8892b0'
                        }
                    },
                    x: {
                        grid: { display: false },
                        title: {
                            display: true,
                            text: 'Date',
                            color: '#8892b0'
                        }
                    }
                }
            }
        });

        // Populate table (most recent first)
        const tbody = document.getElementById('dataTable');
        datesReversed.forEach(date => {
            const d = data[date];
            const total = Object.values(d).reduce((a, b) => a + b, 0);
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><strong>${date}</strong></td>
                <td>${total.toLocaleString()}</td>
                <td style="color: #00d2d3">${d['100%'].toLocaleString()}</td>
                <td style="color: #2ed573">${d['90-99%'].toLocaleString()}</td>
                <td style="color: #7bed9f">${d['85-89%'].toLocaleString()}</td>
                <td style="color: #ffcd38">${d['80-84%'].toLocaleString()}</td>
                <td style="color: #ffa502">${d['70-79%'].toLocaleString()}</td>
                <td style="color: #ff4757">${d['<70%'].toLocaleString()}</td>
            `;
            tbody.appendChild(row);
        });
    </script>
</body>
</html>
